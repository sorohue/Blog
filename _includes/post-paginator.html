<!-- The paginator for post list on HomgPage. -->

<nav aria-label="Page Navigation" class="pag">
  <ul class="pagination align-items-center mt-4 mb-0">
    <!-- left arrow -->
    {% if paginator.previous_page %}
      {% assign prev_url = paginator.previous_page_path | relative_url %}
    {% else %}
      {% assign prev_url = '#' %}
    {% endif %}

    <li class="page-item {% unless paginator.previous_page %}disabled{% endunless %}">
      <a class="page-link" href="{{ prev_url }}" aria-label="previous-page">
        <i class="fas fa-angle-left"></i>
      </a>
    </li>

    <!-- page numbers -->
    {% assign left_ellipsis = false %}
    {% assign right_ellipsis = false %}

    {% for i in (1..paginator.total_pages) %}
      {% assign pre = paginator.page | minus: 1 %}
      {% assign next = paginator.page | plus: 1 %}
      {% assign pre_less = pre | minus: 1 %}
      {% assign next_more = next | plus: 1 %}
      {% assign show = false %}

      {% if paginator.page == 1 %}
        {% if i <= 3 or i == paginator.total_pages %}
          {% assign show = true %}
        {% endif %}
      {% elsif paginator.page == paginator.total_pages %}
        {% if i == 1 or i >= pre_less %}
          {% assign show = true %}
        {% endif %}
      {% else %}
        {% if i == 1 or i == paginator.total_pages %}
          {% assign show = true %}
        {% elsif i >= pre and i <= next %}
          {% assign show = true %}
        {% endif %}
      {% endif %}

      {% if show %}
        <!-- show number -->
        <li class="page-item {% if i == paginator.page %} active{% endif %}">
          <a
            class="page-link"
            href="{% if i > 1 %}{{ site.paginate_path | replace: ':num', i | relative_url }}{% else %}{{ '/' | relative_url }}{% endif %}"
          >
            {{- i -}}
          </a>
        </li>
      {% else %}
        <!-- hide number -->
        {% if i < pre and left_ellipsis == false %}
          <li class="page-item disabled">
            <span class="page-link">...</span>
          </li>
          {% assign left_ellipsis = true %}
        {% elsif i > next and right_ellipsis == false %}
          <li class="page-item disabled">
            <span class="page-link">...</span>
          </li>
          {% assign right_ellipsis = true %}
        {% endif %}
      {% endif %}
    {% endfor %}

    <!-- mobile pagination -->
    <li class="page-index align-middle">
      <span>{{ paginator.page }}</span>
      <span class="text-muted">/ {{ paginator.total_pages }}</span>
    </li>

    <!-- right arrow -->
    {% if paginator.next_page_path %}
      {% assign next_url = paginator.next_page_path | relative_url %}
    {% else %}
      {% assign next_url = '#' %}
    {% endif %}

    <li class="page-item {% unless paginator.next_page_path %}disabled{% endunless %}">
      <a class="page-link" href="{{ next_url }}" aria-label="next-page">
        <i class="fas fa-angle-right"></i>
      </a>
    </li>
  </ul>
</nav>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const pag = document.querySelector(".pag");
  let scrollTimeout;

  const footerOffset = 80; // footer 위 여백(px)

  function handleScroll() {
    const docHeight = document.body.scrollHeight;
    const winHeight = window.innerHeight;
    const scrollPos = window.scrollY + winHeight;
    const distanceToBottom = docHeight - scrollPos;

    if (distanceToBottom <= footerOffset + 20) {
      // at-end 상태
      pag.classList.add("at-end");
      pag.classList.remove("show");
      pag.classList.remove("active");

      // 트랜지션 제거
      pag.style.transition = "none";
      pag.style.bottom = footerOffset - distanceToBottom + "px";
      return;
    } else {
      // at-end 해제
      if (pag.classList.contains("at-end")) {
        // show 상태로 돌아갈 때도 트랜지션 없음
        pag.style.transition = "none";
        // 다음 프레임에서 transition 복원
        requestAnimationFrame(() => {
          pag.style.transition = "bottom 0.3s ease-in-out";
        });
      }
      pag.classList.remove("at-end");
      pag.style.bottom = "";
    }

    // 스크롤 중 → show
    pag.classList.add("show");
    clearTimeout(scrollTimeout);

    scrollTimeout = setTimeout(() => {
      pag.classList.remove("show");
    }, 500);
  }

  // 마우스 하단 근처 → active
  window.addEventListener("mousemove", (e) => {
    if (pag.classList.contains("at-end")) return;

    const threshold = window.innerHeight - 80;
    if (e.clientY > threshold) {
      pag.classList.add("active");
    } else {
      pag.classList.remove("active");
    }
  });

  window.addEventListener("scroll", handleScroll);
});
</script>
<!-- .pagination -->
